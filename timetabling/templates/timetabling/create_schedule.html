{% extends "base.html" %}

{% block title %}Create Schedule{% endblock %}

{% block content %}
<h1>Create a Lesson</h1>
<p>Use the form below to add a lesson to the schedule.</p>

<!-- Step 1: Stage picker -->
<form method="POST">
    {% csrf_token %}
    <label for="stage">Select Stage:</label>
    <select name="stage" id="stage">
        <option value="">---------</option>
        {% for stage in stages %}
            <option value="{{ stage.pk }}"
                {% if selected_stage.pk == stage.pk %}selected{% endif %}>
                {{ stage.name }}
            </option>
        {% endfor %}
    </select>
    <button type="submit" name="select_stage">Load</button>
</form>

<!-- Step 2: Lesson form, only shown after a stage is selected -->
{% if selected_stage %}
<hr>
<h2>Add Lesson for {{ selected_stage.name }}</h2>
<form method="POST">
    {% csrf_token %}
    <input type="hidden" name="stage" value="{{ selected_stage.pk }}">
    {{ form.as_p }}
    <button type="submit" name="save_lesson">Add Lesson</button>
</form>
{% endif %}

<hr>
<h2>Existing Lessons</h2>
{% if lessons %}
<table border="1" cellpadding="5" cellspacing="0">
    <thead>
        <tr>
            <th>Day</th>
            <th>Start</th>
            <th>End</th>
            <th>Stage</th>
            <th>Class Group</th>
            <th>Subject</th>
            <th>Room</th>
            <th>Teacher</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        {% for lesson in lessons %}
        <tr>
            <td>{{ lesson.timeslot.day }}</td>
            <td>{{ lesson.timeslot.start_time|time:"H:i" }}</td>
            <td>{{ lesson.timeslot.end_time|time:"H:i" }}</td>
            <td>{{ lesson.class_group.stage.name }}</td>
            <td>{{ lesson.class_group.name }}</td>
            <td>{{ lesson.subject.name }}</td>
            <td>{{ lesson.room.name }}</td>
            <td>{{ lesson.teacher.user.get_full_name|default:lesson.teacher.user.username }}</td>
            <td>
                <form method="POST" action="{% url 'delete_lesson' lesson.pk %}">
                    {% csrf_token %}
                    <button type="submit">Delete</button>
                </form>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% else %}
<p>No lessons scheduled yet.</p>
{% endif %}

{% endblock %}